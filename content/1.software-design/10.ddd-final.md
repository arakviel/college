# Предметно-орієнтоване проектування на практиці

Отже, ми розглянули інструменти предметно-орієнтованого проектування, призначені для аналізу предметних областей (business domains), обміну знаннями та прийняття стратегічних і тактичних проектних рішень. А тепер уявіть, як всі ці знання будуть застосовуватись на практиці. Давайте розглянемо сценарій роботи над новим проектом. Ваші колеги непогано розуміються в предметно-орієнтованому проектуванні та з самого початку роблять все можливе для розробки ефективних моделей, і, звісно, обов'язково використовують єдину мову (ubiquitous language). В процесі розробки проекту уточнюються межі обмежених контекстів (bounded contexts), підвищується ефективність захисту моделей предметної області. І нарешті, оскільки всі тактичні проектні рішення узгоджуються з бізнес-стратегією, кодова база завжди знаходиться в відмінній формі: всі говорять однією мовою і використовують патерни (patterns) проектування, що відповідають складності моделі. Але тепер давайте повернемося в реальність.

Ваші шанси потрапити в тільки що описані лабораторні умови не вище, ніж виграти в лотерею. Звісно, все можливо, але надзвичайно малоймовірно. На жаль, багато людей помилково вважають, що предметно-орієнтоване проектування застосовується тільки до проектів, що запускаються з нуля в ідеальних умовах, у командах, де кожен має свідоцтво про вищу кваліфікацію в цій сфері. На іронію, найбільшу вигоду від предметно-орієнтованого проектування отримують проекти, які вже запущені в виробництво, довели свою бізнес-спроможність і потребують "підштовхування", щоб справитись з накопиченим технічним боргом і проектною дисгармонією. Так сталося, що робота над такими занедбаними, успадкованими кодовими базами, перетвореними на великі грудки бруду, і є тим, на що витрачається велика частина нашої кар'єри в галузі розробки програмного забезпечення.

Ще одне поширене заблуження про предметно-орієнтоване проектування — це принцип "все або нічого": або ви застосовуєте всі інструменти, запропоновані методологією, або це не предметно-орієнтоване проектування. Але це не так. Зрозуміти всі концепції, притаманні йому, не кажучи вже про їх реалізацію на практиці, може здатися непосильною задачею. На щастя, щоб отримати вигоду від предметно-орієнтованого проектування, не обов'язково застосовувати всі патерни і методи. Особливо це актуально для вже існуючих проектів, де впровадити всі ці патерни і практики в розумні строки практично неможливо.

### Стратегічний аналіз

Порядок нашого вивчення патернів і методів предметно-орієнтованого проектування дає нам найкращу точку для впровадження цих інструментів в організаціях: виділення часу для осмислення бізнес-стратегії організації та поточного стану архітектури її систем.

#### Осмислення предметної області

По-перше, потрібно визначити сферу діяльності компанії:

- Якова предметна область (business domain) діяльності організації?
- Хто її клієнти?
- Яку послугу чи цінність організація надає клієнтам?
- З якими компаніями або продуктами організація конкурує?

Відповівши на ці питання, можна отримати загальний погляд на високорівневі цілі компанії. Далі треба "приблизити погляд" до предметної області і знайти піддомени (subdomains), тобто структурні елементи бізнесу, які використовуються організацією для досягнення своїх цілей.

Хорошою вихідною евристикою є організаційна структура компанії: її відділи та інші організаційні одиниці. Вивчіть порядок співпраці цих підрозділів, що дозволяє компанії успішно конкурувати в своїй сфері.

#### Основні піддомени (core subdomains)

Щоб визначити основні піддомени компанії, потрібно знайти те, чим вона відрізняється від своїх конкурентів:

- Чи є у компанії "унікальна особливість", якої немає у конкурентів? Наприклад, патенти та алгоритми, розроблені власними силами.
- Пам'ятайте, що конкурентне перевагу, а отже, і основні піддомени, не обов'язково мають технічну природу. Чи має компанія нетехнічні переваги? Наприклад, уміння наймати висококваліфікований персонал або створювати унікальний художній дизайн.

#### Універсальні піддомени (generic subdomains)

Щоб визначити універсальні піддомени, шукайте готові рішення, послуги за підпискою або інтеграцію в систему програмного забезпечення з відкритим кодом.

#### Вспомогательные піддомени (supporting subdomains)

Для пошуку допоміжних піддоменів треба подивитись на решту програмних компонентів, які не можна замінити готовими рішеннями, але які прямо не дають конкурентних переваг.

### Ідентифікація проекту

Як тільки буде ознайомлення з простором завдань, можна продовжити дослідження реалізації та прийнятих в рамках проекту рішень. Почніть з компонентів високого рівня. Це не обов'язково повинні бути обмежені контексти в сенсі предметно-орієнтованого проектування, але це можуть бути межі, які використовуються для розбиття бізнес-області на підсистеми.

Особливо важливо звернути увагу на життєві цикли компонентів, які можна розробляти, тестувати і розгортати незалежно від інших.

## Оцінка тактичного замислу

Для кожного високорівневого компонента потрібно перевірити, які бізнес-піддомени він містить і які технічні рішення були прийняті, тобто відповісти на питання: які паттерни використовуються для реалізації бізнес-логіки та опису архітектури компонента?

- Чи відповідає вибране рішення складності початкової задачі?
- Чи є області, де необхідні більш складні паттерни проектування?
- І навпаки, чи є піддомени, де можна спростити рішення або використати існуючі готові рішення?

Використовуйте цю інформацію для прийняття більш обґрунтованих стратегічних та тактичних рішень.

## Оцінка стратегічного замислу

Використовуйте знання про високорівневі компоненти для складання схеми карти контекстів (context map) поточного проєкту, уявляючи ці високорівневі компоненти як обмежені контексти. Визначте та відстежуйте відносини між компонентами з позиції паттернів інтеграції обмежених контекстів.

І, зрештою, проаналізуйте отриману карту контекстів і оцініть архітектуру з точки зору предметно-орієнтованого проектування. Чи є неоптимальні стратегічні проектні рішення? Наприклад:

- Над одним і тим же високорівневим компонентом працює кілька команд.
- Протікання реалізацій основних піддоменів.
- Основний піддомен реалізований сторонньою компанією.
- Часті збої в інтеграції призводять до конфліктів.
- Зовнішні сервіси та успадковані системи нав'язують незручні моделі.

Ці відомості є корисною точкою для планування стратегії модернізації проекту. Але спершу, зважаючи на отримані глибші знання як про простір задач (предметну область), так і про простір рішень, потрібно виявити прогалини в знаннях предметної області. Як зазначено в главі 11, знання про бізнес-область можуть бути втрачені з різних причин. Ця проблема особливо актуальна в основних піддоменах, де бізнес-логіка не лише складна, а й критична для бізнесу. У разі цього слід спробувати відновити втрачені знання за допомогою EventStorming. Крім того, система EventStorming має стати основою для розвитку єдиного мови.

## Визначення стратегії модернізації

Спроби «великого переписування», коли програмісти намагаються переписати систему з нуля, організовуючи цього разу прийнятне проектування і реалізацію всієї системи, рідко призводять до успіху. Ще рідше такі архітектурні оновлення підтримуються керівництвом.

При більш обережному підході до покращення дизайну існуючих систем масштабний замисел поєднується з малими починаннями. Як каже Ерік Еванс (Eric Evans), якісне проектування не розповсюджується на всю велику систему. Це непорушний факт, і тому потрібно прийняти стратегічне рішення, куди саме слід спрямувати зусилля з модернізації. Обов'язковою умовою для прийняття такого рішення є наявність кордонів, що розділяють піддомени системи. Кордони не обов'язково повинні бути фізичними, перетворюючи кожен піддомен на повноцінний обмежений контекст. Краще, як показано на рис. 13.1, почати хоча б з того, щоб вирівняти логічні кордони (що обмежують простори імен, модулі і пакети, в залежності від технологічного стеку) з кордонами піддоменів.

![](/images/83.png)

# Перестановка модулей системи

Перестановка модулів системи — відносно безпечна форма рефакторингу. Бізнес-логіка залишається незмінною, а типи просто переміщуються в більш зручну структуру. І, тим не менш, слід переконатися, що посилання за повними іменами типів, наприклад, для динамічного завантаження бібліотек, для рефлексії (reflection) тощо, не порушуються.

Крім того, потрібно відстежувати бізнес-логіку піддоменів, реалізовану в інших кодових базах: збережені процедури бази даних, безсерверні (serverless) функції тощо. Необхідно не забути провести нові межі й на цих платформах. Наприклад, якщо частина логіки обробляється в збережених процедурах бази даних, потрібно або перейменувати процедури, щоб у їхніх іменах фігурував модуль, до якого вони належать, або застосувати виділену схему бази даних і перемістити збережені процедури.

# Стратегічна модернізація

З глави 1 відомо, що передчасне розбиття системи на найменші з можливих обмежені контексти може бути пов'язано з ризиками. Більш детально обмежені контексти і мікросервіси будуть розглянуті в наступній главі. А поки що шукайте, де можна отримати найбільшу користь від перетворення логічних меж в фізичні. Процес витягання обмеженого контексту (або контекстів) шляхом перетворення логічної межі в фізичну показано на рис. 13.2.

Необхідно поставити наступні запитання:

- Скільки команд працює над однією і тією ж кодовою базою? Якщо кілька, слід розв'язати життєві цикли розробки, визначивши свої обмежені контексти для кожної команди.
- Чи використовують різні компоненти конфліктуючі моделі? Якщо так, то конфліктуючі моделі слід перемістити в окремі обмежені контексти.

![](/images/84.png)

Коли робота по створенню мінімально необхідних обмежених контекстів буде завершена, слід вивчити відносини та патерни інтеграції між ними. Потрібно придивитися до порядку спілкування та співпраці команд, які працюють над різними обмеженими контекстами. Чи мають команди спільні цілі та адекватні рівні співпраці, особливо коли вони використовують спілкування через ситуативну (ad hoc) інтеграцію контекстів або інтеграцію контекстів з загальним ядром (shared kernel)?

Зверніть увагу на ті проблеми, які можуть бути вирішені за допомогою застосування патернів інтеграції контекстів:

## Відносини споживач-постачальник (customer-supplier)

З глави 11 відомо, що розростання організації може звести нанівець колишні моделі спілкування та співпраці. Потрібно знайти компоненти, спроектовані з урахуванням партнерських відносин кількох команд розробників, але вже втративші свою стійкість, і при необхідності провести їх рефакторинг під відносини відповідного типу з розряду споживач-постачальник (застосувавши патерни «Конформист», «Предохоронний шар» (anticorruption layer) або сервіс з відкритим протоколом [open-host service]).

## Предохоронний шар (anticorruption layer)

Предохоронні шари можуть бути корисними для захисту обмежених контекстів від застарілих систем, особливо якщо в останніх використовуються неефективні моделі з тенденцією поширення на нижчестоящі компоненти. Ще один поширений випадок застосування шару захисту від змін пов'язаний із огородженням обмеженого контексту від частих змін у використовуваних ним відкритих інтерфейсах вищестоящого сервісу.

## Сервіс з відкритим протоколом (open-host service)

Якщо зміни в деталях реалізації одного компонента часто поширюються по системі та впливають на її споживачів, варто задуматися над тим, щоб зробити його сервісом з відкритим протоколом: відокремити його модель реалізації від надаваного ним відкритого API.

## Різні шляхи (separate ways)

У великих організаціях дуже висока ймовірність конфліктів, що виникають між командами розробників через необхідність співпрацювати та спільно вдосконалювати загальні функції. Якщо функціональні можливості, що є «яблуком розбрату», для бізнесу не критичні, тобто не входять до основного піддомену, команди можуть піти різними шляхами та реалізувати свої власні рішення, усуваючи таким чином джерело розбіжностей.

# Тактична модернізація

З тактичної точки зору перш за все потрібно знайти найболючіші невідповідності в цінностях для бізнесу та стратегіях реалізацій, коли, наприклад, патерни реалізації основних піддоменів (транзакційний сценарій (transaction script) або ж активна запис (active record)) не відповідають складності моделі. Такі системні компоненти, що безпосередньо впливають на успіх бізнесу, повинні змінюватися найчастіше, але їх складно супроводжувати та вдосконалювати через незручний дизайн.

## Розвиток єдиного мови

Необхідною умовою успішної модернізації проєкту є знання предметної області та ефективна модель предметної області. Як уже неодноразово згадувалося в цій книзі, для отримання знань і побудови ефективної моделі рішення необхідна єдина мова (ubiquitous language) предметно-орієнтованого проєктування.

Не забувайте, що в предметно-орієнтованому проєктуванні є швидкий спосіб збору знань про предметну область: EventStorming. Використовуйте EventStorming для вироблення єдиної з експертами предметної області мови та вивчення застарілої кодової бази, особливо якщо вона являє собою неструктурований код, що ніхто по-справжньому не розуміє. Зберіть усіх, хто пов'язаний з роботою цієї кодової бази, і досліджуйте предметну область. EventStorming — чудовий інструмент відновлення знань про предметну область.

Озброївшись знаннями про предметну область та її моделями, слід вирішити, які патерни реалізації бізнес-логіки найбільше підходять для розглянутої бізнес-функціональності. Як відправну точку треба скористатися евристикою проєктування, розглянутою в главі 10. Наступне рішення, яке слід прийняти, стосується стратегії модернізації: поступової заміни цілих компонентів системи (патерн «Душитель», Strangler) або поступового рефакторингу існуючого рішення.

## Патерн «Душитель» (Strangler)

Інжир-душитель, показаний на рис. 13.3, належить до сімейства тропічних дерев, які мають специфічний спосіб розвитку: душителі ростуть поверх інших дерев-хазяїв. Життя душителя починається з насінини на верхніх гілках дерева-хазяїна. По мірі росту душитель спускається вниз, поки не вкоріниться в ґрунт. В кінцевому підсумку у душителя виростає листя, яке затінює дерево-хазяїна, що призводить до його загибелі.

![](/images/85.png)

Патерн міграції "Душитель" (strangler) заснований на тій самій динаміці розвитку,
що й рослина, на честь якої він названий. Ідея полягає у створенні нового
обмеженого контексту - душителя - і його застосуванні для реалізації нових
232 Частина 111. Застосування предметно-орієнтованого проектування на практиці
вимог і поступової міграції в його функціональність застарілого контексту. Одночасно з цим, за винятком виправлень та інших надзвичайних
ситуацій, зупиняється доопрацювання і розвиток застарілого обмеженого контексту. Зрештою вся функціональність переноситься в новий обмежений контекст - душитель - і за аналогією, що призводить до смерті дерева-господаря,
до позбавлення від застарілої кодової бази.

Зазвичай патерн "Душитель" використовується в тандемі з патерном "Фасад" (facade):
тонким рівнем абстракції, що діє як публічний інтерфейс і
відповідає за перенаправлення запитів на оброблення або в застарілий, або
у модернізований обмежений контекст. Коли міграція завершується, тобто
коли "хазяїн" помирає, фасад видаляють, оскільки він уже більше не потрібен.

![](/images/86.png)

Під час реалізації патерну "Душитель" можна частково відійти від принципу, згідно з яким кожен обмежений контекст є окремою підсистемою
і, отже, не може спільно використовувати свою базу даних з іншими
обмеженими контекстами. І новий, і застарілий контекст може користуватися
однією і тією самою базою даних, щоб уникнути складної інтеграції між контекстами, яка в багатьох випадках може спричинити розподілені транзакції - як показано на рис, обидва контексти повинні працювати з одними і тими самими даними.

Умовою зміни правила про окрему базу даних для кожного обмеженого контексту є те, що врешті-решт, і що раніше, то краще, застарілий контекст буде видалено, а базу даних використовуватиметься виключно
новою реалізацією.

Альтернативою міграції на основі патерну "Душитель" є модернізація
наявної кодової бази, також звана рефакторингом.

![](/images/87.png)

# Рефакторинг тактичних проектних рішень

Різні аспекти міграції тактичних проектних рішень вже розглядалися в главі 11. Але є два нюанси, про які не слід забувати при модернізації застарілої кодової бази.

1. По-перше, замість масштабної переробки набагато безпечніше буде проводити міграцію невеликими послідовними етапами. Тому не варто переробляти транзакційний сценарій або активну запис одразу в модель предметної області, засновану на подіях. Замість цього краще провести проміжний етап проектування агрегатів, заснованих на стані. Докладіть зусиль до пошуку ефективних меж агрегатів. Переконайтеся, що в ці межі потрапляє вся пов'язана бізнес-логіка. Перехід від агрегатів, заснованих на стані, до агрегатів, заснованих на подіях, буде значно безпечнішим, ніж виявлення некоректних меж транзакцій в агрегатах, заснованих на подіях.

2. По-друге, слідуючи тій же логіці невеликих послідовних етапів, рефакторинг моделі предметної області не обов'язково має бути атомарною зміною. Елементи патерну моделі предметної області можуть вводитися поступово. Почніть з пошуку можливих об'єктів-значень. Незмінні об'єкти можуть суттєво спростити рішення, навіть якщо поки що не використовується повноцінна модель предметної області.

В главі 11 було з'ясовано, що рефакторинг активних записів в агрегати не обов'язково проводити «за одну ніч». Це можна зробити поетапно. Почати слід зі збору відповідної бізнес-логіки. Потім потрібно проаналізувати межі транзакцій. Дізнатися, чи є рішення, що вимагають суворої узгодженості, але оперують даними в режимі узгодженості в кінцевому рахунку (eventual consistency)? Або, навпаки, застосовується рішення зі суворою узгодженістю там, де буде достатньо узгодженості в кінцевому рахунку? При аналізі кодової бази не слід забувати, що ці рішення обумовлені не технологією, а бізнес-задачами. Проектувати межі агрегату можна буде тільки після ретельного аналізу вимог до транзакцій.

І, нарешті, при необхідності в процесі рефакторингу застарілої системи нову кодову базу слід захистити від старих моделей за допомогою захисного шару (anticorruption layer), а споживачів — захистити від змін в застарілій кодовій базі через впровадження сервісу з відкритим протоколом (open-host service) і надання опублікованої мови (published language).

# Прагматичне предметно-орієнтоване проектування

У введенні до цієї глави вже говорилося, що застосування предметно-орієнтованого проектування не є чимось із розряду «все або нічого». Застосовувати буквально кожен інструмент, запропонований DDD-технологією, не обов'язково. Може статися так, що з якоїсь причини тактичні патерни можуть у вас не працювати. Можливо, ваше уподобання віддається іншим патернам проектування, оскільки в вашій конкретній області вони працюють краще, або ж просто тому, що ці патерни вважаються більш ефективними. Це абсолютно нормально!

У процесі аналізу своєї предметної області і її стратегії потрібно підбирати ефективні моделі для вирішення конкретних завдань і, що найбільш важливо, приймати проектні рішення на основі потреб предметної області: в цьому і є сенс предметно-орієнтованого проектування!

Варто ще раз підкреслити, що предметно-орієнтоване проектування не пов'язане з агрегатами (aggregate) або об'єктами-значеннями (value object). Його сенс полягає в тому, щоб дозволити предметній області вашого бізнесу керувати рішеннями з проектування програмного забезпечення.

# Як «продати» предметно-орієнтоване проектування?

Коли я виступаю на розглянуту нами тему на технологічних конференціях, майже завжди отримую одне й те ж питання: «Звучить чудово, але як мені "продати" предметно-орієнтоване проектування своїй команді та керівництву?» Це надзвичайно важливе питання.

Продаж не легкий, і особисто я ненавиджу цей процес. Однак, якщо подумати, розробка програмного забезпечення також є продажем. Ми продаємо наші ідеї команді, керівництву або клієнтам. Але продати методологію, яка охоплює такий широкий спектр аспектів проектних рішень і навіть виходить за межі зони проектування з метою залучення інших зацікавлених осіб, може бути надзвичайно важко.

Без підтримки керівництва не обійтися ні одне суттєве організаційне зміна. Але якщо керівники вищого рівня поки ще не знайомі з предметно-орієнтованим проектуванням або не готові приділяти свій час вивченню бізнес-цінності цієї методології, то вона не буде для них пріоритетом, тим більше що зміна в процесі проектування, пов'язана з застосуванням DDD, здається їм значною. Але, на щастя, це зовсім не означає відсутність можливості використання вами предметно-орієнтованого проектування.

# Закритте предметно-орієнтоване проектування

Перетворіть предметно-орієнтоване проектування не в організаційну стратегію, а в частину свого професійного набору інструментів. Патерни і методи, властиві DDD, відносяться до технології програмування, і оскільки вашою роботою є розробка програмного забезпечення, скористайтеся ними!

Давайте подивимося, як можна впровадити DDD у свою повсякденну роботу, не створюючи при цьому надмірного шуму.

## Єдинa мова

Використання єдиної мови (ubiquitous language) є краєугольним каменем практики предметно-орієнтованого проектування. Вона необхідна для виявлення знань предметної області, спілкування і ефективного моделювання рішень.

На щастя, ця цілком звичайна практика, що не виходить за рамки здорового глузду. Прислухайтеся до мови, якою користуються зацікавлені сторони під час обговорення предметної області. Обережно направляйте термінологію з технічного жаргону в бік її бізнес-значення.

Шукайте суперечливі терміни та вимагайте їх роз'яснень. Наприклад, якщо у одного й того ж предмета кілька назв, шукайте причину цього. Не зустрічаються ли такі різні моделі в одному й тому ж рішенні? Можливо, це прихований контекст, який потрібно зробити явним. Якщо значення одне й те ж, проявіть здоровий глузд і вимагайте використання одного й того ж терміна.

Крім того, спілкуйтеся як можна більше з експертами предметної області. І для цього не обов'язково проводити формальні зустрічі. Краще поспілкуватися десь у неформальній обстановці за чашкою кави. Поговоріть з бізнес-експертами про сферу бізнесу. Спробуйте перейти на їхню мову. Шукайте складнощі в розумінні та просіть роз'яснень. І не переживайте — бізнес-експерти зазвичай раді співпраці з розробниками, щиро зацікавленими вивченням предметної області!

Найголовніше — використовуйте єдину мову у своєму коді та у всіх інформаційних обмінах, пов'язаних з проектом. Проявіть терпіння. Зміна термінології, раніше усталеної в вашій організації, вимагатиме деякого часу, але в кінцевому підсумку вона все одно приживеться.

## Обмежені контексти

Вивчаючи можливі варіанти декомпозиції, визначте принципи, що лежать в основі патерну обмеженого контексту:

♦ **Чому краще розробляти проблемно-орієнтовані моделі, а не одну модель для всіх сценаріїв використання?** Тому що рішення «все в одному» рідко бувають ефективними абсолютно для всього.

♦ **Чому обмежений контекст не може містити конфліктуючі моделі?** Через зростаючу складність рішення та труднощі у його розумінні.

♦ **Чому робота кількох команд над однією і тією ж кодовою базою - погана ідея?** Через постійно виникаючі конфлікти між командами, що перешкоджають співпраці.

Скористайтеся тією ж самою аргументацією і для патернів інтеграції обмежених контекстів: переконайтесь, що задача, що вирішується кожним патерном, вам зрозуміла та чітко визначена.

## Тактичні проектні рішення

Обговорюючи патерни тактичного проектування, не апелюйте до авторитету: «Давайте скористаємося тут агрегатом, оскільки так написано в книзі по предметно-орієнтованому проектуванню!» Краще включіть логіку. Наприклад:

♦ **Чому важливі чіткі межі транзакцій?** Для захисту узгодженості даних.

♦ **Чому транзакція бази даних не може змінити більше одного екземпляра агрегата?** Щоб забезпечити коректність меж узгодженості.

♦ **Чому зовнішній компонент не може безпосередньо змінювати стан агрегата?** Щоб забезпечити спільне розміщення всієї пов'язаної бізнес-логіки та відсутність її дублікатів.

♦ **Чому не можна передавати частину функцій агрегата збереженій процедурі?** Щоб забезпечити відсутність продубльованої логіки. Продубльована логіка, особливо в логічно та фізично віддалених компонентах системи, схильна до розсинхронізації та пошкодження даних.

♦ **Чому треба прагнути до того, щоб межі агрегатів мали найменший розмір?** Тому що великий обсяг змін в межах однієї транзакції ускладнює агрегат і негативно впливає на продуктивність.

♦ **Чому замість подій як джерела даних не можна просто записувати події у файл журналу?** Тому що це не дає довгострокових гарантій узгодженості даних.

Якщо ж говорити про події як джерела даних (event sourcing), то коли рішення вимагатиме використання моделі предметної області, заснованої на подіях (event-sourced domain model), просування реалізації цього патерну може зіткнутися з труднощами. Давайте поглянемо на психологічний прийом досвідченого спеціаліста, який може допомогти в цьому.

## Модель предметної області, заснована на подіях

Незважаючи на численні переваги, словосполучення «події як джерело даних» (event sourcing) звучить для багатьох занадто радикально. Як і в разі всього, що розглядалося в цій книзі, рішення полягає в тому, щоб дозволити предметній області керувати самим цим рішенням.

Поговоріть з експертами предметної області. Покажіть їм моделі, засновані на станах і подіях. Поясніть, чим вони відрізняються одна від одної та розкрийте переваги, які надає використання подій як джерела даних, особливо щодо тимчасового виміру (фактор часу). Швидше за все, вони будуть в захваті від наданого цією технологією рівня проникнення в суть процесу і самі виступатимуть за використання патерну подій як джерела даних (event sourcing).

Спілкуючись з експертами предметної області, не забувайте працювати над вдосконаленням єдиної мови!

## Висновок

У цій главі були розглянуті різні методи використання інструментальних засобів предметно-орієнтованого проектування в реальних сценаріях: при роботі над вже існуючими проектами та з застарілими кодовими базами, причому не обов'язково з уже готовою командою зрілих спеціалістів у галузі предметно-орієнтованого проектування.

Як і в проектах, що запускаються з нуля, завжди починайте з аналізу предметної області. Поставте собі наступне питання: які цілі компанії і стратегія їх досягнення? Використовуйте організаційну структуру та вже існуючі рішення з проектування програмного забезпечення, щоб визначити піддомени, прийнятні для організації та їх типи. Маючи ці знання, сплануйте стратегію модернізації. Шукайте вузькі місця. Стреміться витягти найбільшу цінність для бізнесу. Модернізуйте застарілий код або шляхом рефакторингу, або шляхом заміни тих чи інших компонентів. В будь-якому разі робіть це поступово. Великі перебудови ведуть до більш високого ступеня ризику, а не підвищення їх цінності для бізнесу!

І останнє: інструменти предметно-орієнтованого проектування можна використовувати навіть якщо методологія DDD ще не отримала широкого поширення у вашій організації. Скористайтеся прийнятними інструментами, а при їх обговоренні з колегами завжди використовуйте логіку та принципи, що покладені в основу кожного патерну.

Ця глава завершує розгляд самого предметно-орієнтованого проектування як такого. У четвертій частині книги йтиметься про взаємодію предметно-орієнтованого проектування з іншими методологіями та патернами.

## Вправи

1. Припустимо, що інструменти та методи предметно-орієнтованого проектування треба впровадити в уже існуючий проект. Яким буде ваш перший крок?

   - А) Рефакторинг усієї бізнес-логіки в модель предметної області, засновану на подіях.
   - Б) Аналіз предметної області організації та її стратегії.
   - В) Удосконалення компонентів системи, переконавшись, що вони слідують принципам належних обмежених контекстів.
   - Г) Ніяким, оскільки застосувати предметно-орієнтоване проектування до вже запущеного проекту неможливо.

2. В чому саме патерн «Душитель» (Strangler), застосовуваний у процесі міграції, суперечить деяким основним принципам предметно-орієнтованого проектування?

   - А) Загальна база даних використовується одразу кількома обмеженими контекстами.
   - Б) Якщо оновлений обмежений контекст є основним піддоменом, то його програмний код дублюється в старій та новій реалізаціях проекту.
   - В) Над одним і тим же обмеженим контекстом працює одразу кілька команд.
   - Г) А і Б.

3. Чому настійно не рекомендується проводити рефакторинг бізнес-логіки, заснованої на використанні активних записів, безпосередньо в модель предметної області, засновану на подіях?

   - А) Рефакторинг меж агрегатів в процесі вивчення предметної області простіше проводити за допомогою моделі на основі станів.
   - Б) Вносити масштабні зміни набагато безпечніше в поетапному режимі.
   - В) А і Б.
   - Г) Все вищезазначене невірно. Непосередній перехід до моделі предметної області, заснованої на подіях, доцільний навіть для транзакційних сценаріїв.

4. Чому при введенні в практику програмування паттерну агрегатів у вашої команди виникає питання про причину, чому агрегат не може просто посилатися на всі можливі сутності, дозволяючи тим самим здійснити обхід усієї бізнес-області з одного місця? Яку відповідь їм слід дати?
