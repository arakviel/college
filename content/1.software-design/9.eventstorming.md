# EventStorming

В цій главі буде зроблено перерву в розгляді патернів та технік проектування, і вся увага буде зосереджена на нескладному процесі моделювання під назвою **EventStorming**. Цей процес об'єднує основні аспекти предметно-орієнтованого проектування, розглянуті в попередніх главах.

Будуть розглянуті порядок організації та процес проведення **EventStorming** для ефективного обміну знаннями про предметну область і створення єдиної мови (**ubiquitous language**).

## Що таке EventStorming?

**EventStorming** являє собою технологічно простий спосіб зібрати разом людей для швидкого моделювання бізнес-процесу за допомогою техніки мозкового штурму. У певному сенсі **EventStorming** є тактичним інструментом для обміну знаннями в області бізнесу.

У кожної сесії **EventStorming** завжди задані рамки дослідження: бізнес-процес, вивчення якого цікавить групу спеціалістів. Учасники досліджують процес як послідовність подій предметної області, представлених наліпками на часовій шкалі. Крок за кроком модель доповнюється новими поняттями — діючими особами (actor), командами (command), зовнішніми системами (external system) та іншими — до того моменту, поки всі її елементи не розкриють історію ходу всього бізнес-процесу.

## Хто бере участь в EventStorming?

Треба розуміти, що мета **EventStorming** — дізнатися як можна більше за найкоротший час. Ми запрошуємо ключових спеціалістів і не хочемо даремно витрачати їхній дорогоцінний час.

> — Альберто Брандоліні (Alberto Brandolini), творець **EventStorming**

В ідеалі в **EventStorming** повинна брати участь різноманітна група спеціалістів. Насправді брати участь можуть всі, хто має відношення до розглядуваної предметної області: інженери, експерти в предметній області, власники продуктів, тестувальники, UX/UI-проектувальники, технічна підтримка тощо. Чим більше людей з різним досвідом буде залучено, тим більше знань буде виявлено.

Але не слід робити групу учасників занадто великою. У кожного учасника має бути можливість внести свій вклад у процес, але для груп більше 10 учасників це може бути ускладнено.

## Що потрібно для проведення EventStorming?

**EventStorming** вважається технологічно простим процесом, оскільки він проводиться з використанням маркерів та наліпок, дуже великої кількості наліпок.

Давайте подивимося, що потрібно для проведення **EventStorming**:

### Вільний простір

Насамперед слід подбати про великий простір для моделювання. Найкраще, судячи з зображення на рис, для цього підходить стіна, до якої прикріплена рулонна папір. Також може підійти велика біла дошка, але вона повинна бути якнайбільше, оскільки для моделювання буде задіяна вся її площа.

![](/images/71.png)

## Стікери

Далі знадобиться безліч стікерів різних кольорів. Вони будуть використовуватися для представлення різних концепцій предметної області, і кожен учасник повинен мати можливість безперешкодно їх додавати, тому слід заздалегідь переконатися в наявності достатньої кількості стікерів потрібних кольорів для всіх учасників. Кольори, традиційно використовувані для **EventStorming**, розглядаються в наступному розділі. Краще дотримуватися розглянутих угод, щоб відповідати всім доступним на сьогоднішній день книгам і тренінгам по **EventStorming**.

## Маркери

Також знадобляться маркери, якими можна буде робити написи на стікерах. Знову ж таки, витратні матеріали не повинні стати вузьким місцем при обміні знаннями — маркерів має вистачати всім учасникам.

## Закуски

Типовий **EventStorming** триває від двох до чотирьох годин, тому для відновлення енергії слід взяти з собою легкі закуски.

## Зал

І, нарешті, для проведення **EventStorming** знадобиться просторий зал. Переконайтеся, що посередині немає величезного столу, який буде заважати учасникам вільно переміщатися і спостерігати за ходом моделювання. Крім того, стільці також будуть заважати процесу. Потрібно, щоб спеціалісти брали активну участь і ділилися знаннями, а не сиділи в кутку з відстороненим виглядом. Тому, по можливості, стільці треба винести з залу.

## Процес проведення EventStorming

**EventStorming** зазвичай проводиться в 10 етапів. На кожному етапі модель збагачується додатковою інформацією та концепціями.

### Етап 1: Проведення неструктурованого дослідження

**EventStorming** починається з мозкового штурму по виявленню подій предметної області, пов'язаних з досліджуваною предметною областю. До подій предметної області відноситься все цікаве, що відбувається в предметній області. Події предметної області важливо формулювати в минулому часі (див. рис.) — ними описується те, що вже сталося.

![](/images/72.png)

На цьому етапі всі учасники беруть пачку помаранчевих стікерів, записують будь-які
події предметної області, які спадають їм на думку, і прикріплюють їх до простору для моделювання.

На цій ранній стадії не слід турбуватися про впорядкування подій або навіть
про їхню деяку надмірність. Цей етап присвячений мозковому штурму з питання
усього, що може статися в предметній області.

Група фахівців має продовжувати виявлення подій предметної області
доти, доки швидкість додавання нових подій не дійде до суттєвого
зниження.

### Етап 2: Вибудовування в хронологічному порядку

Потім учасники переглядають виявлені події предметної області та вибудовують їх у порядку походження в предметній області.

Події мають починатися з "успішного сценарію" (happy path): потоку подій, що описують успішний бізнес-сценарій.

Після того як "успішний шлях" пройдено, можна приступити до додавання альтернативних сценаріїв - наприклад, шляхів, на яких трапляються помилки або
приймаються інші бізнес-рішення. Як показано на рис, розгалуження потоку
може бути виражено двома напрямками, що виходять від попереднього
події, або стрілками, намальованими на просторі моделювання.

![](/images/73.png)

На цьому ж етапі можна виправити некоректні події, видалити дублікати
і, звісно ж, за необхідності додати відсутні події.

### Етап 3: Проблемні місця (pain points)

Після вибудовування подій у хронологічному порядку, погляньте на них ширше,
щоб визначити ті місця в процесі, які потребують особливої уваги. Це
можуть бути якісь вузькі місця, дії, що потребують втручання людини
або ж ті, що потребують автоматизації, відсутня документація або ж відсутні знання предметної області.

Важливо виявити всі недоліки, щоб до них можна було легко повернутися пізніше.
Проблемні місця, як показано на рис, позначаються повернутими на 45 градусів (наклеєними у вигляді ромбів) рожевими стікерами.

![](/images/74.png)

Звісно, цей етап - не єдина можливість виявлення проблемних місць.
Організатор має відстежувати коментарі учасників протягом усього
процесу. Коли порушуються питання або вимальовуються проблеми, вони мають бути відображені на відповідному рожевому стікері.

### Этап 4: Выявление ключевых событий (pivotal events)

Коли події вибудувано в хронологічному порядку із зазначенням проблемних
місць (pain points), слід виявити значущі бізнес-події, що вказують на зміну контексту або закінчення одного з етапів. Вони називаються ключовими/поворотними подіями (pivotal events) і відзначаються вертикальною рискою,
що розділяє події до і після ключової події.

Наприклад, як показано на рис, істотні зміни в процесі оформлення замовлення являють собою події "Кошик покупок ініціалізовано",
"Замовлення ініціалізовано", "Замовлення відправлено", "Замовлення доставлено" і "Замовлення повернуто".

Ключові події є індикатором потенційних меж обмежених обмежень
контекстів.

![](/images/75.png)

### Етап 5: Виявлення команд (commands)

На відміну від подій предметної області, які описують те, що вже сталося, команда описує те, що викликало подію або потік подій. Команди описують дії системи, які, на відміну від подій предметної області, формулюються в наказовому способі. Наприклад:

- Опублікувати кампанію.
- Откотити транзакцію.
- Підтвердити замовлення.

Команди записуються на світло-блакитних стікерах і розміщуються в просторі моделювання перед подіями, які вони можуть викликати. Якщо конкретну команду виконує діяч (actor) в певній ролі, то, як показано на рис, інформація про діючу особу (actor) розміщується на маленькому жовтому стікері перед відповідною командою. Діяч є портретом користувача (persona) в досліджуваній предметній області, наприклад, клієнта, адміністратора або редактора.

Звісно, не всі команди будуть мати асоційовану з ними діючу особу. Тому інформацію про неї слід додавати лише там, де це очевидно.

На наступному етапі модель буде доповнена іншими об'єктами, здатними запускати команди.

![](/images/76.png)

### Етап 6: Виявлення правил (policies)

Практично завжди в модель додається ряд команд, не пов'язаних з конкретною діючою особою (actor). На цьому етапі відбувається виявлення правил автоматизації, здатних виконувати такі команди.

Правило автоматизації — це сценарій, у якому подія запускає виконання команди. Іншими словами, команда автоматично виконується, коли відбувається певна подія предметної області.

Як показано на прикладі стікера «Правило» на рис, правила на просторі моделювання представлені у вигляді лілових стікерів, що з'єднують події з командами.

![](/images/77.png)

Якщо розглядається команда, яка повинна запускатися тільки при виконанні певних критеріїв прийняття рішення, ці критерії можна вказати явно на стікері з правилом (policy). Наприклад, якщо потрібно ініціювати команду escalate після події «Отримана скарга», але тільки якщо скарга надійшла від VIP-клієнта, умова «Тільки для VIP-клієнтів» може бути явно зазначена на стікері правила.

Якщо події та команди знаходяться далеко одна від одної, на просторі моделювання можна намалювати стрілку, що їх з'єднує.

### Етап 7: Виявлення моделей читання (read model)

Модель читання — це представлення даних у предметній області, яке діюча особа використовує для прийняття рішення про виконання команди. Це може бути один із екранних інтерфейсів системи, звіт, сповіщення тощо.

Моделі читання представлені зеленими стікерами (див. стікер «Кошик» на рис ) з коротким описом джерела інформації, необхідної для обґрунтування рішення діючої особи (actor). Оскільки команда виконується після того, як діюча особа перегляне модель читання, моделі читання розташовуються перед командами.

![](/images/78.png)

### Виявлення зовнішніх систем (external systems)

Цей етап присвячений доповненню моделі зовнішніми системами. Зовнішньою вважають
будь-яка система, яка не є частиною досліджуваної предметної області. Вона може виконувати команди (що вважається введенням) або отримувати повідомлення про події (що вважається виведенням).

Зовнішні системи представлені рожевими стікерами. На рис система управління інформацією про клієнтів - СRМ (зовнішня система) ініціює виконання команди "Відправити замовлення". Коли відправлення підтверджено (подія), про це
повідомляється в СRМ (зовнішня система) через правило (policy).

До кінця цього етапу всі команди повинні або виконуватися діючими особами (actor)), або ініціюватися правилами (policy), або викликатися зовнішніми
системами (external system).

![](/images/79.png)

### Етап 9: Виявлення агрегатів

Коли всі події та команди представлені на просторі моделювання, учасники можуть приступати до обмірковування порядку об'єднання пов'язаних концепцій в агрегати. Агрегат отримує команди і породжує події.

Агрегати, як показано на рис представлені у вигляді великих жовтих стікерів із командами ліворуч і подіями праворуч.

![](/images/80.png)

### Етап 1О: Виявлення обмежених контекстів

Останнім етапом EventStorming є пошук агрегатів, що відносяться один до одного або через подання тісно пов'язаних функцій, або через їх зв'язування якимось із правил
один до одного або через подання тісно пов'язаних функцій, або через їхнє зв'язування якимось із правил (policy). Групи агрегатів, як показано на
рис, утворюють природних кандидатів на межі обмежених контекстів.

![](/images/81.png)

### Варіанти

Альберто Брандоліні, творець EventStorming, визначає процес EventStorming як керівництво, а не як набір жорстких правил. З процесом проведення можна поекспериментувати, щоб знайти той самий «рецепт», який підійде вам більше за все.

Згідно з моїм досвідом, процес проведення EventStorming в організації я надаю перевагу почати з вивчення загальної картини предметної області, виконуючи кроки з 1-го (несструктуроване дослідження) по 4-й (виявлення ключових подій [pivotal events]). Отримана модель охоплює широкий спектр предметної області компанії, створює міцну основу для єдиних мов (ubiquitous language) і визначає можливі межі обмежених контекстів (bounded context).

Отримавши загальну картину та ідентифікувавши різні бізнес-процеси, проводиться окрема сесія для кожного бізнес-процесу - цього разу чітко слідуючи всім етапам, щоб змоделювати весь процес.

В кінці повного сеансу EventStorming буде отримана модель, що описує події предметної області (domain events), команди (commands), агрегати (aggregate) і навіть можливі обмежені контексти (bounded contexts). Втім, все це лише приємні бонуси. Справжня цінність EventStorming полягає в самому процесі — обміні знаннями між різними зацікавленими сторонами, узгодженні їх ментальних моделей, виявленні конфліктуючих моделей і, що не менш важливо, формулюванні єдиної мови (ubiquitous language).

Отримана в результаті модель може бути прийнята як основа для реалізації моделі предметної області, заснованої на подіях. Рішення про те, чи йти цим шляхом чи ні, залежить від сфери вашого бізнесу. Якщо буде прийнято рішення про реалізацію моделі предметної області, заснованої на подіях (event sourced domain model), ви будете мати межі обмежених контекстів, агрегати і, звісно, начерки необхідних подій предметної області.

### Коли слід проводити EventStorming

EventStorming може проводитись з багатьох причин:

- **З метою вироблення єдиної мови (ubiquitous language)**
  При співпраці груп у побудові моделі бізнес-процесу вони природним чином синхронізують термінологію і починають використовувати одну і ту ж мову.

- **З метою моделювання бізнес-процесу**
  EventStorming — ефективний спосіб побудови моделі бізнес-процесу. Оскільки в основі його лежить виявлення будівельних блоків за методикою DDD, він також є ефективним способом виявлення меж агрегатів і обмежених контекстів.

- **З метою вивчення нових бізнес-вимог**
  EventStorming можна використати, щоб переконатися в єдності поглядів усіх учасників на нові функції та виявити граничні випадки, які не охоплюються бізнес-вимогами.

- **З метою відновлення знань предметної області**
  З часом знання предметної області можуть бути втрачені. Особливо гостро це проявляється стосовно застарілих систем, які потребують модернізації. EventStorming є ефективним способом об'єднання знань, якими володіє кожен учасник, в єдину зв'язну картину.

- **З метою дослідження способів покращення існуючого бізнес-процесу**
  Проведення наскрізного аналізу бізнес-процесу дає розуміння, необхідне для виявлення неефективних сторін і можливостей для покращення процесу.

- **З метою прийому в команду нових співробітників**
  Проведення EventStorming за участю нових співробітників — чудовий спосіб розширення знань предметної області.

### Коли не слід проводити EventStorming

EventStorming буде менш успішним, якщо вивчаємий бізнес-процес простий або цілком очевидний, наприклад, коли він зводиться до виконання ряду послідовних кроків без жодної цікавої бізнес-логіки чи складності.

### Поради щодо проведення

Під час проведення EventStorming із групою фахівців, які раніше ніколи не брали участі в EventStorming, я вважаю, що спочатку краще дати короткий огляд усього
процесу. Під час огляду пояснюються майбутні дії учасників, суть наміченого до вивчення бізнес-процесу та елементи моделювання, що використовуються
під час семінару. У міру пояснення елементів моделювання - подій предметної області (domain events), команд (commands), дійових осіб (actors)
тощо, щоб допомогти учасникам запам'ятати кольорове маркування, на просторі
моделювання викладаються всі умовні позначення, показані на рис,
у вигляді стикерів, що застосовуються надалі. Під час семінару умовні позначення мають бути видні всім його учасникам.

![](/images/82.png)

## Відслідковування динаміки проведення семінару

По ходу семінару важливо відслідковувати активність групи. Якщо динаміка процесу сповільнюється, треба зрозуміти, чи можна активізувати процес, задаючи різні питання, чи вже пора переходити до наступного етапу.
Слід пам'ятати, що EventStorming — це колективне заняття, тому треба переконатися, що воно таким і є. Переконайтеся, що у кожного фахівця є можливість взяти участь у моделюванні та обговоренні. Якщо помітите, що деякі учасники відокремлюються від колективу, спробуйте залучити їх до процесу, задаючи питання про поточний стан моделі.

EventStorming передбачає інтенсивні роздуми учасників, і на деякому етапі групі знадобиться перерва. Не відновлюйте сеанс, поки всі учасники не повернуться в зал. Відновіть процес з огляду поточного стану моделі, щоб повернути групу до атмосфери спільного моделювання.

### Проведення EventStorming з віддаленими учасниками

EventStorming був придуманий як технологічно простий вид діяльності, що передбачає спілкування фахівців і їхнє спільне навчання в межах одного приміщення. Створювач EventStorming Альберто Брандоліні часто висловлювався проти віддаленого проведення, оскільки, коли група знаходиться в різних місцях, досягти такого ж рівня участі та, відповідно, співпраці та обміну знаннями неможливо.
Однак з початком пандемії COVID-19 у 2020 році проведення особистих зустрічей стало неможливим. Для забезпечення спільної роботи та спрощення проведення віддалених сеансів EventStorming було спробовано кілька інструментів. На момент написання книги найбільш помітним з них став miro.com.
При проведенні EventStorming в режимі онлайн слід проявляти особливу терплячість і враховувати зниження ефективності спілкування.
Мій досвід показує, що віддалені сеанси EventStorming більш ефективні при меншій кількості учасників. Якщо на звичайному семінарі EventStorming можуть бути присутні до 10 осіб, то онлайн-сеанси я надаю перевагу обмежувати п'ятьма учасниками. Коли для обміну знаннями потрібно більше учасників, можна провести кілька сеансів, а потім порівняти та об'єднати отримані моделі.
Як тільки ситуація дозволить, треба повернутися до EventStorming з особистою присутністю учасників.

### Висновок

EventStorming — це семінар, проведений для спільної роботи по моделюванню бізнес-процесів. Окрім отриманих в результаті його проведення моделей, його основною перевагою є обмін знаннями. До кінця сесії всі учасники синхронізують свої ментальні моделі в розумінні бізнес-процесу та наберуться першого досвіду використання єдиного мови (ubiquitous language).
EventStorming схожий на їзду на велосипеді. Куди простіше навчитися це робити, ніж читати про це в книзі. До того ж, він проводиться в легкій і невимушеній манері. Щоб його ініціювати, не потрібно бути якимось гуру. Просто організуйте його, дотримуйтеся інструкцій і вчіться керувати процесом під час його проведення.

## Вправи

1. Кого слід запрошувати на EventStorming?
   А) Програмістів.
   Б) Експертів предметної області.
   В) QA-спеціалістів.
   Г) Всіх представників зацікавлених сторін, які мають знання в області досліджуваної предметної області.

2. Для чого слід проводити EventStorming?
   А) Щоб вибудувати єдину мову.
   Б) Щоб вивчити нову предметну область.
   В) Щоб відновити втрачені знання про діючий проект.
   Г) Щоб залучити нових учасників до проекту.
   Д) Щоб виявити шляхи оптимізації бізнес-процесів.
   Е) Вірні всі вищезазначені відповіді.

3. Яких результатів слід очікувати від EventStorming?
   А) Кращого загального розуміння предметної області.
   Б) Закладення міцної основи для єдиної мови.
   В) Позбавлення від прогалин у розумінні предметної області. Створення моделі на основі подій, яку можна буде використати для реалізації моделі предметної області.
   Г) Всі вищезазначені результати, але в залежності від мети проведення сесії.
